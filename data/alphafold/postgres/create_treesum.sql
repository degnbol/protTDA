CREATE TABLE genus as
SELECT
    taxtree.parent, taxtree.domain,
    AVG(avg_n)             as avg_n,
    AVG(avg_maxrep1)       as avg_maxrep1,
    AVG(avg_maxrep2)       as avg_maxrep2,
    AVG(avg_maxpers1)      as avg_maxpers1,
    AVG(avg_maxpers2)      as avg_maxpers2,
    AVG(avg_nrep1)         as avg_nrep1,
    AVG(avg_nrep2)         as avg_nrep2,
    VARIANCE(avg_n)        as var_n,
    VARIANCE(avg_maxrep1)  as var_maxrep1,
    VARIANCE(avg_maxrep2)  as var_maxrep2,
    VARIANCE(avg_maxpers1) as var_maxpers1,
    VARIANCE(avg_maxpers2) as var_maxpers2,
    VARIANCE(avg_nrep1)    as var_nrep1,
    VARIANCE(avg_nrep2)    as var_nrep2,
    AVG(avg_nrep1_b0)      as avg_nrep1_b0,
    AVG(avg_nrep1_b1)      as avg_nrep1_b1,
    AVG(avg_nrep1_b2)      as avg_nrep1_b2,
    AVG(avg_nrep1_b3)      as avg_nrep1_b3,
    AVG(avg_nrep1_b4)      as avg_nrep1_b4,
    AVG(avg_nrep1_b5)      as avg_nrep1_b5,
    AVG(avg_nrep1_b6)      as avg_nrep1_b6,
    AVG(avg_nrep1_b7)      as avg_nrep1_b7,
    AVG(avg_nrep1_b8)      as avg_nrep1_b8,
    AVG(avg_nrep1_b9)      as avg_nrep1_b9,
    AVG(avg_nrep1_t10)     as avg_nrep1_t10,
    AVG(avg_nrep2_b00)     as avg_nrep2_b00,
    AVG(avg_nrep2_b01)     as avg_nrep2_b01,
    AVG(avg_nrep2_b02)     as avg_nrep2_b02,
    AVG(avg_nrep2_b03)     as avg_nrep2_b03,
    AVG(avg_nrep2_b04)     as avg_nrep2_b04,
    AVG(avg_nrep2_b05)     as avg_nrep2_b05,
    AVG(avg_nrep2_b06)     as avg_nrep2_b06,
    AVG(avg_nrep2_b07)     as avg_nrep2_b07,
    AVG(avg_nrep2_b08)     as avg_nrep2_b08,
    AVG(avg_nrep2_b09)     as avg_nrep2_b09,
    AVG(avg_nrep2_t1)      as avg_nrep2_t1
FROM taxtree INNER JOIN species
ON taxtree.tax = species.parent
WHERE taxtree.rankp = 'genus'
GROUP BY taxtree.parent, taxtree.domain;

CREATE TABLE family as
SELECT
    taxtree.parent, taxtree.domain,
    AVG(avg_n)             as avg_n,
    AVG(avg_maxrep1)       as avg_maxrep1,
    AVG(avg_maxrep2)       as avg_maxrep2,
    AVG(avg_maxpers1)      as avg_maxpers1,
    AVG(avg_maxpers2)      as avg_maxpers2,
    AVG(avg_nrep1)         as avg_nrep1,
    AVG(avg_nrep2)         as avg_nrep2,
    VARIANCE(avg_n)        as var_n,
    VARIANCE(avg_maxrep1)  as var_maxrep1,
    VARIANCE(avg_maxrep2)  as var_maxrep2,
    VARIANCE(avg_maxpers1) as var_maxpers1,
    VARIANCE(avg_maxpers2) as var_maxpers2,
    VARIANCE(avg_nrep1)    as var_nrep1,
    VARIANCE(avg_nrep2)    as var_nrep2,
    AVG(avg_nrep1_b0)      as avg_nrep1_b0,
    AVG(avg_nrep1_b1)      as avg_nrep1_b1,
    AVG(avg_nrep1_b2)      as avg_nrep1_b2,
    AVG(avg_nrep1_b3)      as avg_nrep1_b3,
    AVG(avg_nrep1_b4)      as avg_nrep1_b4,
    AVG(avg_nrep1_b5)      as avg_nrep1_b5,
    AVG(avg_nrep1_b6)      as avg_nrep1_b6,
    AVG(avg_nrep1_b7)      as avg_nrep1_b7,
    AVG(avg_nrep1_b8)      as avg_nrep1_b8,
    AVG(avg_nrep1_b9)      as avg_nrep1_b9,
    AVG(avg_nrep1_t10)     as avg_nrep1_t10,
    AVG(avg_nrep2_b00)     as avg_nrep2_b00,
    AVG(avg_nrep2_b01)     as avg_nrep2_b01,
    AVG(avg_nrep2_b02)     as avg_nrep2_b02,
    AVG(avg_nrep2_b03)     as avg_nrep2_b03,
    AVG(avg_nrep2_b04)     as avg_nrep2_b04,
    AVG(avg_nrep2_b05)     as avg_nrep2_b05,
    AVG(avg_nrep2_b06)     as avg_nrep2_b06,
    AVG(avg_nrep2_b07)     as avg_nrep2_b07,
    AVG(avg_nrep2_b08)     as avg_nrep2_b08,
    AVG(avg_nrep2_b09)     as avg_nrep2_b09,
    AVG(avg_nrep2_t1)      as avg_nrep2_t1
FROM taxtree INNER JOIN genus
ON taxtree.tax = genus.parent
WHERE taxtree.rankp = 'family'
GROUP BY taxtree.parent, taxtree.domain;

CREATE TABLE "order" as
SELECT
    taxtree.parent, taxtree.domain,
    AVG(avg_n)             as avg_n,
    AVG(avg_maxrep1)       as avg_maxrep1,
    AVG(avg_maxrep2)       as avg_maxrep2,
    AVG(avg_maxpers1)      as avg_maxpers1,
    AVG(avg_maxpers2)      as avg_maxpers2,
    AVG(avg_nrep1)         as avg_nrep1,
    AVG(avg_nrep2)         as avg_nrep2,
    VARIANCE(avg_n)        as var_n,
    VARIANCE(avg_maxrep1)  as var_maxrep1,
    VARIANCE(avg_maxrep2)  as var_maxrep2,
    VARIANCE(avg_maxpers1) as var_maxpers1,
    VARIANCE(avg_maxpers2) as var_maxpers2,
    VARIANCE(avg_nrep1)    as var_nrep1,
    VARIANCE(avg_nrep2)    as var_nrep2,
    AVG(avg_nrep1_b0)      as avg_nrep1_b0,
    AVG(avg_nrep1_b1)      as avg_nrep1_b1,
    AVG(avg_nrep1_b2)      as avg_nrep1_b2,
    AVG(avg_nrep1_b3)      as avg_nrep1_b3,
    AVG(avg_nrep1_b4)      as avg_nrep1_b4,
    AVG(avg_nrep1_b5)      as avg_nrep1_b5,
    AVG(avg_nrep1_b6)      as avg_nrep1_b6,
    AVG(avg_nrep1_b7)      as avg_nrep1_b7,
    AVG(avg_nrep1_b8)      as avg_nrep1_b8,
    AVG(avg_nrep1_b9)      as avg_nrep1_b9,
    AVG(avg_nrep1_t10)     as avg_nrep1_t10,
    AVG(avg_nrep2_b00)     as avg_nrep2_b00,
    AVG(avg_nrep2_b01)     as avg_nrep2_b01,
    AVG(avg_nrep2_b02)     as avg_nrep2_b02,
    AVG(avg_nrep2_b03)     as avg_nrep2_b03,
    AVG(avg_nrep2_b04)     as avg_nrep2_b04,
    AVG(avg_nrep2_b05)     as avg_nrep2_b05,
    AVG(avg_nrep2_b06)     as avg_nrep2_b06,
    AVG(avg_nrep2_b07)     as avg_nrep2_b07,
    AVG(avg_nrep2_b08)     as avg_nrep2_b08,
    AVG(avg_nrep2_b09)     as avg_nrep2_b09,
    AVG(avg_nrep2_t1)      as avg_nrep2_t1
FROM taxtree INNER JOIN family
ON taxtree.tax = family.parent
WHERE taxtree.rankp = 'order'
GROUP BY taxtree.parent, taxtree.domain;

CREATE TABLE class as
SELECT
    taxtree.parent, taxtree.domain,
    AVG(avg_n)             as avg_n,
    AVG(avg_maxrep1)       as avg_maxrep1,
    AVG(avg_maxrep2)       as avg_maxrep2,
    AVG(avg_maxpers1)      as avg_maxpers1,
    AVG(avg_maxpers2)      as avg_maxpers2,
    AVG(avg_nrep1)         as avg_nrep1,
    AVG(avg_nrep2)         as avg_nrep2,
    VARIANCE(avg_n)        as var_n,
    VARIANCE(avg_maxrep1)  as var_maxrep1,
    VARIANCE(avg_maxrep2)  as var_maxrep2,
    VARIANCE(avg_maxpers1) as var_maxpers1,
    VARIANCE(avg_maxpers2) as var_maxpers2,
    VARIANCE(avg_nrep1)    as var_nrep1,
    VARIANCE(avg_nrep2)    as var_nrep2,
    AVG(avg_nrep1_b0)      as avg_nrep1_b0,
    AVG(avg_nrep1_b1)      as avg_nrep1_b1,
    AVG(avg_nrep1_b2)      as avg_nrep1_b2,
    AVG(avg_nrep1_b3)      as avg_nrep1_b3,
    AVG(avg_nrep1_b4)      as avg_nrep1_b4,
    AVG(avg_nrep1_b5)      as avg_nrep1_b5,
    AVG(avg_nrep1_b6)      as avg_nrep1_b6,
    AVG(avg_nrep1_b7)      as avg_nrep1_b7,
    AVG(avg_nrep1_b8)      as avg_nrep1_b8,
    AVG(avg_nrep1_b9)      as avg_nrep1_b9,
    AVG(avg_nrep1_t10)     as avg_nrep1_t10,
    AVG(avg_nrep2_b00)     as avg_nrep2_b00,
    AVG(avg_nrep2_b01)     as avg_nrep2_b01,
    AVG(avg_nrep2_b02)     as avg_nrep2_b02,
    AVG(avg_nrep2_b03)     as avg_nrep2_b03,
    AVG(avg_nrep2_b04)     as avg_nrep2_b04,
    AVG(avg_nrep2_b05)     as avg_nrep2_b05,
    AVG(avg_nrep2_b06)     as avg_nrep2_b06,
    AVG(avg_nrep2_b07)     as avg_nrep2_b07,
    AVG(avg_nrep2_b08)     as avg_nrep2_b08,
    AVG(avg_nrep2_b09)     as avg_nrep2_b09,
    AVG(avg_nrep2_t1)      as avg_nrep2_t1
FROM taxtree INNER JOIN "order"
ON taxtree.tax = "order".parent
WHERE taxtree.rankp = 'class'
GROUP BY taxtree.parent, taxtree.domain;

CREATE TABLE phylum as
SELECT
    taxtree.parent, taxtree.domain,
    AVG(avg_n)             as avg_n,
    AVG(avg_maxrep1)       as avg_maxrep1,
    AVG(avg_maxrep2)       as avg_maxrep2,
    AVG(avg_maxpers1)      as avg_maxpers1,
    AVG(avg_maxpers2)      as avg_maxpers2,
    AVG(avg_nrep1)         as avg_nrep1,
    AVG(avg_nrep2)         as avg_nrep2,
    VARIANCE(avg_n)        as var_n,
    VARIANCE(avg_maxrep1)  as var_maxrep1,
    VARIANCE(avg_maxrep2)  as var_maxrep2,
    VARIANCE(avg_maxpers1) as var_maxpers1,
    VARIANCE(avg_maxpers2) as var_maxpers2,
    VARIANCE(avg_nrep1)    as var_nrep1,
    VARIANCE(avg_nrep2)    as var_nrep2,
    AVG(avg_nrep1_b0)      as avg_nrep1_b0,
    AVG(avg_nrep1_b1)      as avg_nrep1_b1,
    AVG(avg_nrep1_b2)      as avg_nrep1_b2,
    AVG(avg_nrep1_b3)      as avg_nrep1_b3,
    AVG(avg_nrep1_b4)      as avg_nrep1_b4,
    AVG(avg_nrep1_b5)      as avg_nrep1_b5,
    AVG(avg_nrep1_b6)      as avg_nrep1_b6,
    AVG(avg_nrep1_b7)      as avg_nrep1_b7,
    AVG(avg_nrep1_b8)      as avg_nrep1_b8,
    AVG(avg_nrep1_b9)      as avg_nrep1_b9,
    AVG(avg_nrep1_t10)     as avg_nrep1_t10,
    AVG(avg_nrep2_b00)     as avg_nrep2_b00,
    AVG(avg_nrep2_b01)     as avg_nrep2_b01,
    AVG(avg_nrep2_b02)     as avg_nrep2_b02,
    AVG(avg_nrep2_b03)     as avg_nrep2_b03,
    AVG(avg_nrep2_b04)     as avg_nrep2_b04,
    AVG(avg_nrep2_b05)     as avg_nrep2_b05,
    AVG(avg_nrep2_b06)     as avg_nrep2_b06,
    AVG(avg_nrep2_b07)     as avg_nrep2_b07,
    AVG(avg_nrep2_b08)     as avg_nrep2_b08,
    AVG(avg_nrep2_b09)     as avg_nrep2_b09,
    AVG(avg_nrep2_t1)      as avg_nrep2_t1
FROM taxtree INNER JOIN class
ON taxtree.tax = class.parent
WHERE taxtree.rankp = 'phylum'
GROUP BY taxtree.parent, taxtree.domain;

CREATE TABLE kingdom as
SELECT
    taxtree.parent, taxtree.domain,
    AVG(avg_n)             as avg_n,
    AVG(avg_maxrep1)       as avg_maxrep1,
    AVG(avg_maxrep2)       as avg_maxrep2,
    AVG(avg_maxpers1)      as avg_maxpers1,
    AVG(avg_maxpers2)      as avg_maxpers2,
    AVG(avg_nrep1)         as avg_nrep1,
    AVG(avg_nrep2)         as avg_nrep2,
    VARIANCE(avg_n)        as var_n,
    VARIANCE(avg_maxrep1)  as var_maxrep1,
    VARIANCE(avg_maxrep2)  as var_maxrep2,
    VARIANCE(avg_maxpers1) as var_maxpers1,
    VARIANCE(avg_maxpers2) as var_maxpers2,
    VARIANCE(avg_nrep1)    as var_nrep1,
    VARIANCE(avg_nrep2)    as var_nrep2,
    AVG(avg_nrep1_b0)      as avg_nrep1_b0,
    AVG(avg_nrep1_b1)      as avg_nrep1_b1,
    AVG(avg_nrep1_b2)      as avg_nrep1_b2,
    AVG(avg_nrep1_b3)      as avg_nrep1_b3,
    AVG(avg_nrep1_b4)      as avg_nrep1_b4,
    AVG(avg_nrep1_b5)      as avg_nrep1_b5,
    AVG(avg_nrep1_b6)      as avg_nrep1_b6,
    AVG(avg_nrep1_b7)      as avg_nrep1_b7,
    AVG(avg_nrep1_b8)      as avg_nrep1_b8,
    AVG(avg_nrep1_b9)      as avg_nrep1_b9,
    AVG(avg_nrep1_t10)     as avg_nrep1_t10,
    AVG(avg_nrep2_b00)     as avg_nrep2_b00,
    AVG(avg_nrep2_b01)     as avg_nrep2_b01,
    AVG(avg_nrep2_b02)     as avg_nrep2_b02,
    AVG(avg_nrep2_b03)     as avg_nrep2_b03,
    AVG(avg_nrep2_b04)     as avg_nrep2_b04,
    AVG(avg_nrep2_b05)     as avg_nrep2_b05,
    AVG(avg_nrep2_b06)     as avg_nrep2_b06,
    AVG(avg_nrep2_b07)     as avg_nrep2_b07,
    AVG(avg_nrep2_b08)     as avg_nrep2_b08,
    AVG(avg_nrep2_b09)     as avg_nrep2_b09,
    AVG(avg_nrep2_t1)      as avg_nrep2_t1
FROM taxtree INNER JOIN phylum
ON taxtree.tax = phylum.parent
WHERE taxtree.rankp = 'kingdom'
GROUP BY taxtree.parent, taxtree.domain;


